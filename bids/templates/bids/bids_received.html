{% extends 'core/base2.html' %}
{% load static %}
{% load i18n %}
{# bids/templates/bids/bids_received.html #}

{% block title %}{% trans "Bids Received" %}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white p-8 shadow-md rounded-md">

    <!-- ✅ Message affiché si le paramètre ?success=1 est dans l'URL -->
    {% if request.GET.success == '1' %}
    <div class="mb-6 p-4 bg-green-100 border border-green-300 text-green-800 rounded text-center">
        ✅ {% trans "Bid accepted successfully. This project is now private." %}
    </div>
    {% endif %}

    <h2 class="text-2xl font-bold mb-6 text-center">{% trans "Bids Received for this Project" %}</h2>

    {% if bids %}
        <ul class="space-y-6">
            {% for bid in bids %}
            <li class="border p-4 rounded-md bg-gray-50">
                <p class="text-lg font-semibold">
                    {% trans "Contractor" %}: {{ bid.contractor_username }}
                </p>
                <p>
                    {% trans "Amount" %}: ${{ bid.amount }}
                </p>
                <p>
                    {% trans "Status" %}: {{ bid.status }}
                </p>
                <p class="text-gray-700 text-sm mt-1">
                    {% trans "Submitted on" %}: {{ bid.created_at }}
                </p>
                <p class="mt-2">
                    {{ bid.message }}
                </p>

                <!-- ✅ Bouton pour accepter une offre (visible uniquement si statut = pending et si client == owner) -->
                {% if bid.status == "pending" and request.user == project.client %}
                <form method="POST" action="{% url 'accept-bid' bid.id %}" class="mt-4" onsubmit="return confirmAccept();">
                    {% csrf_token %}
                    <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">
                        {% trans "Accept this Bid" %}
                    </button>
                </form>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-center text-gray-600">{% trans "No bids have been received for this project yet." %}</p>
    {% endif %}
</div>

<!-- 🛡️ Script de confirmation avant d’accepter une offre -->
<script>
function confirmAccept() {
    return confirm("{% trans 'Are you sure you want to accept this bid? This action cannot be undone.' %}");
}
</script>
{% endblock %}
